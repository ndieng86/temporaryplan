<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="../public/css/style.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <title>All client</title>
</head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script type="text/javascript" src="../public/js/typeahead.min.js"></script>

<script type="text/javascript">
  $(document).ready(function () {
    $('input.typeahead').typeahead({
      name: 'name_fr',
      remote: 'http://localhost:3021/search?key=%QUERY',
      limit: 10
    });
  });
</script>

<body>

  <div class="container-fluid">
    <div class="row top">
      <%- include('./partials/header') %>
    </div>
  </div>
  <div class="row">
    <div class="col-3"></div>
    <div class="col-9">

      <div>
        <form action="/logout" method="POST">
          <input type="button" class="btn">Logout>
        </form>
      </div>
    </div>
  </div>
  <div class="container-fluid contenu">
    <h1 style="margin-top: 50px;">Liste de nouveaux Clients</h1>
    <div class="row">
      <div class="col-3">
        <a href="/new_client" class="btn" style="background-color: #2C7FC1; color: white;">+Ajouter</a>
        <a href="#" class="btn" style="background-color: #2C7FC1; color: white;">Modifier</a>
        <a href="#" class="btn" style="background-color: #2C7FC1; color: white;">Supprimer</a>
        <a href="/clients" class="btn  btn-sm" style="background-color: #2C7FC1; color: white;">
          <span class="glyphicon glyphicon-refresh"></span>
        </a>

      </div>
      <div class="col-4"></div>
      <div class="col-5 bs-example text-center">
        <form action="#" method="POST">
          <label for="Recherche">Trouver un Client</label>
          <input id="searchVal" name="searchVal" type="text" name="typeahead"
            class="form-control typeahead tt-query col-10" autocomplete="off" spellcheck="false" required
            placeholder="entrer le courriel du Client" value="">
          <button class="btn col-2" style="background-color: #2C7FC1; color: white;" id="search">rechercher</button>
          <button class="btn col-2" style="background-color: #2C7FC1; color: white;" id="resetclients">Effacer</button>
          <p id="text_Search">**Vous pouvez renseigner l'une des informations suivantes
            nom/prenom/email/uid/codepostale/telephone pour trouver un client</p>
        </form>
      </div>
    </div>

    <table class="table">
      <thead>
        <tr>
          <th scope="col"><input type="checkbox">Tous</th>
          <th scope="col">Uid Client</th>
          <th scope="col">Action</th>
          <th scope="col">Prenom</th>
          <th scope="col">Nom</th>
          <th scope="col">Langue préférée</th>
          <th scope="col">Courriel</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <% for(client of clients) { %>
          <tr>
            <td><input type="checkbox"></td>
            <td>
              <%= client.uid %>
            </td>
            <td>
              <a href="/edit_Client/<%=client.uid%>">|
                <span class="glyphicon glyphicon-pencil"></span>
              </a>|
              <a href="/vue_client/<%=client.uid%>">
                <span class="glyphicon glyphicon-eye-open"></span>
              </a>|
            </td>

            <td>
              <%= client.firstname %>
            </td>
            <td>
              <%= client.lastname %>
            </td>
            <td>
              <%= client.lang %>
            </td>
            <td>
              <%= client.email %>
            </td>

          </tr>
          <% } %>
      </tbody>
    </table>

  </div>
</body>
<script>

  $(document).ready(function () {

    $('#search').click(function (event) {
      event.preventDefault();
      var searchVal = $("#searchVal").val();

      console.log(searchVal)
      $.ajax("/research/", {

        type: "GET",
        data: {
          searchVal: searchVal
        },

        success: function (data) {
          for (var i = 0; i < data.Oneclient.length; i++) {
            console.log(data.Oneclient[i].firstname)
            $("#tbody").html("<tr><td><input type='checkbox'></td><td>" + data.Oneclient[i].uid +
              "</td><td><a href='/edit_Client/" + data.Oneclient[i].uid + "'>|<span class='glyphicon glyphicon-pencil'></span></a><a href='/vue_client/" + data.Oneclient[i].uid + "'>|<span class='glyphicon glyphicon-eye-open'></span>|</a></td><td>" + data.Oneclient[i].firstname +
              "</td > <td>" + data.Oneclient[i].lastname + "</td><td>" + data.Oneclient[i].lang + "</td><td>" + data.Oneclient[i].email)
          }
        },
        error: function () {
          console.log('error!')
        }

      })
    })
    /*******************************************************************************/
    $('#resetclients').click(function (event) {
      event.preventDefault();
      var searchVal = $("#resetclients").val();

      console.log(searchVal)
      $.ajax("/resetclients/", {

        type: "GET",
        data: {
          searchVal: searchVal
        },

        success: function (data) {

          for (var i = 0; i < data.listclient.length; i++) {
            console.log(data.listclient[i].firstname)
            $("#tbody").append("<tr><td><input type='checkbox'></td><td>" + data.listclient[i].uid +
              "</td><td><a href='/edit_Client/" + data.listclient[i].uid + "'>|<span class='glyphicon glyphicon-pencil'></span></a><a href='/vue_client/" + data.listclient[i].uid + "'>|<span class='glyphicon glyphicon-eye-open'></span>|</a></td><td>" + data.listclient[i].firstname +
              "</td > <td>" + data.listclient[i].lastname + "</td><td>" + data.listclient[i].lang + "</td><td>" + data.listclient[i].email)
          }

        },
        error: function () {
          console.log('error!')
        }

      })
    })
  })
</script>

</html>