<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="../public/css/style.css" />
  <link rel="stylesheet" href="../public/css/editor.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="../public/js/typeahead.min.js"></script>
  <script type="text/javascript" src="../public/js/editor.js"></script>
  <script>
    $(document).ready(function () {
      $("#description").Editor();
    });
  </script>
  <title>Edit-Client</title>
</head>

<body>
  <div class="container-fluid">
    <div class="row top">
      <%- include('./partials/header') %>
    </div>
  </div>
  <div class="rows-fluid contenu">
    <h1 id="title">Mofidication Client </h1>
    <div class="row">
      <div class="col-3">
        <div class="row">
          <label for="uid client" class="label-form col-2">uid Client</label>
          <input type="text" value="<%=infoClient[0].uid%>" class="col-2" disabled id="uidclient" name="uidclient">
        </div>
      </div>
    </div>
    <form method="POST">
      <h4>Informations Personnelles</h4>
      <div class="row" id="infos_client">
        <div class="row" id="newClient">
          <div class="row">
            <div class="form-group col-3">
              <label for="Prenom">Prenom:</label>
              <input type="text" class="form-control" placeholder="Prenom" id="firstname" name="firstname"
                value="<%= infoClient.firstname%>" />
            </div>
            <div class="form-group col-3">
              <label for="flexCheckChecked">Nom :
              </label>
              <input type="text" class="form-control col-4" placeholder="Nom" id="lastname" name="lastname"
                value="<%= infoClient.lastname%>" />
            </div>
            <div class="col-3"></div>
            <div class="col-1">
              <div class="row">
                <label for="Sexe">Sexe :
                </label>
                <select class="form-control col-2" name="gender" id="gender">
                  <option>-------</option>
                  <option value="m">Homme</option>
                  <option value="f">Femme</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
      <button id="AddClient" class="btn btn-default">+Ajouter un Client</button>
      <hr />
      <div class="row">
        <label for="Courriel">Courriel :
        </label>
      </div>
      <div class="row">
        <div class="col-3">
          <input type="email" class="form-control col-4" placeholder="Courriel 1" id="email" name="email"
            value="<%= infoClient.email %>" />
        </div>
        <div class="col-2"></div>
        <div class="col-3">
          <input type="email" class="form-control col-4" placeholder="Courriel 2" id="email2" name="email2"
            value="<%= infoClient.email2 %>" />
        </div>
        <div class="col-6"></div>
      </div>
      <hr />
      <div class="row">
        <h6>Langues</h6>
        <div class="col-3">
          <select class="form-control" id="languages" name="languages" value="<%= infoClient.languages%>">
            <option>---Bilingue?---</option>
            <option value="1">Français</option>
            <option value="2">Anglais</option>
            <option value="3">Bilingue</option>
          </select>
        </div>
        <div class="col-3"></div>
        <div class="col-3">
          <select class="form-control" id="lang" name="lang" value="<%= infoClient.lang%>">
            <option>---Langue Préférée---</option>
            <option value="fr">Français</option>
            <option value="en">Anglais</option>
          </select>
        </div>
        <div class="col-3"></div>
      </div>
      <button class="btn btn-secondary col-auto" id="infoEdit">save Client</button>
      <div class="row" id="saveCleint">

      </div>
    </form>
    <hr />
    <button class="btn btn-secondary col-auto" id="AddressEdit">Editer Addresse</button>
    <div class="row" id="address_part" style="display: none;">
      <form id="form">
        <h4>Adresse</h4>
        <div class="row">
          <div class="row">
            <div class="col-2">
              <label for="telephone">Telephone 1:
              </label>
              <input type="text" class="form-control col-4" placeholder="telephone 1" id="phone1" name="phone1" />
            </div>

            <div class="col-2">
              <label for="telephone">Telephone 2:
              </label>
              <input type="text" class="form-control col-4" placeholder="telephone 2" id="phone2" name="phone2" />
            </div>
            <div class="col-2">
              <label for="telephone">Telephone 3:
              </label>
              <input type="tel" class="form-control col-4" placeholder="telephone 3" id="phone3" name="phone3" />
            </div>
          </div>
          <hr />
          <div class="row" id="mydiv">
            <div class="row">
              <div class="col-1">
                <label for="Numero" class="form-label">Numero</label>
                <input type="text" placeholder="numéro" class="form-control" id="street_no" name="street_no" />
              </div>
              <div class="col-3">
                <label for="Rue" class="form-label">Rue</label>
                <input type="text" placeholder="Rue" class="form-control" id="street" name="street" />
              </div>
              <div class="col-1">
                <label for="Ville" class="form-label">Ville</label>
                <input type="text" placeholder="Ville" class="form-control" id="city" name="city" />
              </div>
              <div class="col-5">
                <label for="Ville" class="form-label">Ville</label>
                <select class="form-control" id="uid_city" name="uid_city" value="">
                  <option>---Villes---</option>
                  <% for(city of territoires) { %>
                    <option value="<%= city.uid_city %>">
                      <%= city.city_name%>(<%=city.area_code %>-<%=city.territory_name %>)
                    </option>
                    <% } %>

                </select>
              </div>
              <div class="col-1">
                <label for="Province" class="form-label">Province</label>
                <select class="form-control" id="province" name="province">
                  <option value="null">-Provinces-</option>
                  <% for(prov of provinces) { %>
                    <option value="<%= prov.uid_province %>">
                      <%= prov.code_prov%>
                    </option>
                    <% } %>
                </select>
              </div>
              <div class="col-1">
                <label for="Code Postale" class="form-label">Code Postale</label>
                <input type="text" placeholder="Code Postale" class="form-control" id="zip" name="zip" />
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-10"></div>
          <button class="btn btn-secondary col-auto" id="EditAddress">save Address</button>
        </div>
        <hr />
      </form>
    </div>

    <div class="row">

      <form id="services" style="display: none">

        <div class="row">
          <h3>Ajouter un Projet au Client</h3>
          <div class="col-4">
            <div class="row">
              <div class="row">
                <label for="Service" class="form-label">Service:</label>
                <select class="form-control col-2" name="service" id="service">
                  <option value="1">Courtier Immobilier residentiel</option>
                  <option value="2">Courtier hypothécaire</option>
                  <option value="3">Notaire</option>
                  <option value="4">Inspecteur en Bâtiment</option>
                  <option value="5">Gestion Immobilière</option>
                  <option value="6">Investisseur Privé</option>
                  <option value="7">Installation de Système d'alarme</option>
                  <option value="8">Évaluateur Agréé</option>
                  <option value="9">Courtier d'assurances</option>
                  <option value="10">Avocat</option>
                  <option value="11">Conseiller Financier</option>
                  <option value="12">Courtier immobilier commercial</option>
                  <option value="13">Évaluation environnementale des sols</option>
                  <option value="14">Ingénieur géotechnique</option>
                  <option value="15">Courtier d'assurances</option>on>
                  <option value="17">Consultant en immigration</option>
                  <option value="18">Courtier Immobilier</option>
                  <option value="19">Entretien / Ménage résidentiel</option>
                  <option value="20">Arpenteur-Géomètre</option>
                  <option value="21">Notaire Fiscaliste</option>
                  <option value="22">Déménagement</option>
                  <option value="23">Business Immigration</option>
                  <option value="24">Home Staging</option>
                  <option value="25">Comptable</option>

                </select>
              </div>
              <div class="row">
                <label for="nombre de soumision" class="form-label">Nombre de Soumission</label>
                <div class="col-4">
                  <input type="text" placeholder="00000000" class="form-control" id="Nbr_soussmission"
                    name="Nbr_soussmission" />
                </div>
              </div>
              <hr />
              <div class="row">
                <div class="row">
                  <div class="col-4">
                    <label for="prix" class="form-label">Prix</label>
                    <input type="text" placeholder="000000" class="form-control" id="lead_price" name="lead_price" />
                  </div>
                  <div class="col-11"></div>
                </div>
                <hr />
                <div class="row">
                  <label for="Adresse" class="form-label">Adresse</label>
                  <select class="form-control" name="address" id="address">
                    <option>
                      <% for(Ad of adresses) { %>
                    <option value="<%=Ad.uid%>">
                      <%= Ad.street_no %>
                        <%= Ad.street %>
                          <%= Ad.city %>
                            <%= Ad.zip %>
                    </option>
                    <% } %>
                      </option>


                  </select>
                </div>
                <hr />
                <div class="row">
                  <label for="prix" class="form-label">Statut de Projet</label>
                  <select class="form-control" id="status" name='status'>
                    <option>------------Statut du projet-------------</option>
                    <option value="completed">completed</option>
                    <option value="inactive-incomplete">inactive-incomplete</option>
                    <option value="cancelled-before-qualification">cancelled-before-qualification</option>
                    <option value="cancelled-after-qualification">cancelled-after-qualification</option>
                    <option value="new">new</option>
                    <option value="free">free</option>
                    <option value="cancelled-sold-elsewhere">cancelled-sold-elsewhere</option>
                    <option value="active">active</option>
                    <option value="interne">interne</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          <div class="col-2"></div>
          <div class="col-6">
            <div class="form-group shadow-textarea">
              <label for="Description">Description</label>
              <textarea class="form-control z-depth-1" id="description" rows="10" name="description"
                style="color:black"></textarea>
            </div>
          </div>
        </div>

        <hr />


      </form>
    </div>
    <input type="hidden" />
    <button class="btn btn-secondary col-auto" id="EditProjet" style="margin-top: 35px;">Editer Projet</button>

  </div>
  </div>
  </div>

  <script>
    // ///////////////////////////////Add Client/////////////////////
    $(document).ready(function () {
      /*****************Handle checkbox button*****************/
      // Set initial state
      $('#Activation').val($(this).is(':checked'));

      // It gets checked to false as uncheck
      // is the default
      $('#Activation').click(function () {
        $('#Activation').val($(this).is(':checked'));
      });
      /***********************Add Address***************************/

      /*******************Add Project******************************/

      /////////////////////////////////////////////////Edit client//////////////////
      var Addclient = document.getElementById('AddClient');
      Addclient.addEventListener('click', function (event) {
        event.preventDefault();
        var infosClient = document.getElementById('newClient');
        var newClient = infosClient.firstElementChild.cloneNode(true);
        infosClient.appendChild(newClient);
      });
      var client = $("#uidclient").val();
      $.ajax("/ReadClient/", {

        type: "GET",
        data: {
          client: client
        },

        success: function (data) {
          document.getElementById("firstname").value = data.infoclient[0].firstname;
          document.getElementById("lastname").value = data.infoclient[0].lastname;
          document.getElementById("gender").value = data.infoclient[0].gender;
          document.getElementById("email").value = data.infoclient[0].email;
          document.getElementById("email2").value = data.infoclient[0].email2;
          document.getElementById("languages").value = data.infoclient[0].languages;
          document.getElementById("lang").value = data.infoclient[0].lang;


        },
        error: function () {
          console.log('error!')
        }



      });
      /***********************************************Edit Client******************************************************/
      document.getElementById('infoEdit').addEventListener('click', function (event) {
        event.preventDefault();

        var clientInfos = {
          uidclient: $('#uidclient').val(),
          firstname: $('#firstname').val(),
          lastname: $('#lastname').val(),
          email: $('#email').val(),
          email2: $('#email2').val(),
          gender: $('#gender').val(),
          lang: $('#lang').val(),
          languages: $('#languages').val()
        };
        $.ajax({
          type: 'POST',
          url: '/edit_Client/uid',
          data: clientInfos,
          success: function (data) {
            console.log(data)

            /***********************************************************************/

          },
          error: function (err) {
            console.log(err)
          }
        })
      })



      // //////////////Edit Address/////////////////////////////////////////

      document.getElementById('EditAddress').addEventListener('click', function (event) {
        event.preventDefault();

        var AddressInfos = {
          uidclient: $('#uidclient').val(),
          phone1: $('#phone1').val(),
          phone2: $('#phone2').val(),
          phone3: $('#phone3').val(),
          street_no: $('#street_no').val(),
          street: $('#street').val(),
          city: $('#city').val(),
          uid_city: $('#uid_city').val(),
          province: $('#province').val(),
          zip: $('#zip').val(),
        };
        $.ajax({
          type: 'POST',
          url: '/editAddress/uid',
          data: AddressInfos,
          success: function (data) {
            console.log(data.projecInfos[0].description)
            document.getElementById('services').style.display = 'block';
            /* document.getElementById("phone1").value = '';
             document.getElementById("phone2").value = '';
             document.getElementById("phone3").value = '';
             document.getElementById("street_no").value = '';
             document.getElementById("street").value = '';
             document.getElementById("city").value = '';
             document.getElementById("uid_city").value = 'null';
             document.getElementById("province").value = 'null';
             document.getElementById("zip").value = '';
             /*************project infos*******************/
            document.getElementById("service").value = data.projecInfos[0].uid;
            document.getElementById("description").value = data.projecInfos[0].description;
            document.getElementById("lead_price").value = data.projecInfos[0].lead_price;
            document.getElementById("status").value = data.projecInfos[0].status;
            document.getElementById("Nbr_soussmission").value = data.projecInfos[0].max_quotes;
            document.getElementById("address").value = data.projecInfos[0].uid_address;


          },
          error: function () {
            console.log('error!');
          }


        })
      })


      var AddressEdit = document.getElementById('AddressEdit'); AddressEdit.addEventListener('click', function (
        event) {
        event.preventDefault();
        document.getElementById('address_part').style.display = 'block';
        var client = $("#uidclient").val();
        $.ajax("/ReadAddress/", {

          type: "GET",
          data: {
            client: client
          },

          success: function (data) {
            document.getElementById('phone1').value = data.infoAddress[0].phone1;
            document.getElementById('phone2').value = data.infoAddress[0].phone2;
            document.getElementById('phone3').value = data.infoAddress[0].phone3;
            document.getElementById('street_no').value = data.infoAddress[0].street_no;
            document.getElementById('street').value = data.infoAddress[0].street;
            document.getElementById('city').value = data.infoAddress[0].city;
            document.getElementById('uid_city').value = data.infoAddress[0].uid_city;
            document.getElementById('province').value = data.infoAddress[0].province;
            document.getElementById('zip').value = data.infoAddress[0].zip;


          },
          error: function () {
            console.log('error!')
          }



        });
      })
      // /////////////Edit Project////////////////////////////////
      document.getElementById('EditProjet').addEventListener('click', function (event) {
        event.preventDefault();

        var InfosProject = {
          Service: $('#service').val(),
          Description: $('#description').val(),
          Activation: $('#Activation').val(),
          ProjectStatus: $('#status').val(),
          Nbr_soussmission: $('#Nbr_soussmission').val(),
          Address: $('#address').val(),
          Activate_Date: $('#active_Date').val()
        };

        $.ajax({
          type: 'POST',
          url: '/EditProject/uid',
          data: InfosProject,
          success: function (data) {
            console.log(data.Service);
          },
          error: function () {
            console.log('error!');
          }
        });
      });



    });
  </script>
</body>

</html>