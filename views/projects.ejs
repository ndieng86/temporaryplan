<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="../public/css/style.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <title>New-Projects</title>
</head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script type="text/javascript" src="../public/js/typeahead.min.js"></script>
<script type="text/javascript">
  $(document).ready(function () {
    $('input.typeahead').typeahead({
      name: 'name_fr',
      remote: 'http://localhost:3021/search?key=%QUERY',
      limit: 10
    });
  });
</script>

<body>
  <div class="container-fluid">
    <div class="row top">
      <%- include('./partials/header') %>
    </div>
  </div>
  <div class="container-fluid contenu">
    <h1 style="margin-top: 50px;">Liste de nouveaux projet</h1>
    <div class="row">
      <div class="col-3">
        <a href="/new_client" class="btn" style="background-color: #2C7FC1; color: white;">+Ajouter</a>
        <a href="#" class="btn" style="background-color: #2C7FC1; color: white;">Modifier</a>
        <a href="#" class="btn" style="background-color: #2C7FC1; color: white;">Supprimer</a>
        <a href="/projects" class="btn  btn-sm" style="background-color: #2C7FC1; color: white;">
          <span class="glyphicon glyphicon-refresh"></span>
        </a>
      </div>
      <div class="col-4"></div>
      <div class="col-5 bs-example text-center">
        <form action="#" method="POST">
          <label for="Recherche">Trouver un projet</label>
          <input id="searchVal" name="searchVal" type="text" name="typeahead"
            class="form-control typeahead tt-query col-12" autocomplete="off" spellcheck="false"
            placeholder="entrer le courriel du Client">
          <input type="submit" class="btn col-2" style="background-color: #2C7FC1; color: white;" id="search"
            value="rechercher">
          <input type="submit" class="btn col-2" style="background-color: #2C7FC1; color: white;" id="resetproj"
            value="Effacer">
          <p id="text_Search">Vous pouvez renseigner l'une des informations suivantes nom/prenom/email/uid Client/uid
            projet/codepostale/telephone pour le trouver projet</p>
      </div>
      </form>
    </div>
    <table class="table">
      <thead>
        <tr>
          <th scope="col"><input type="checkbox"></th>
          <th scope="col">Uid Client</th>
          <th scope="col">Uid Projet</th>
          <th scope="col">Action</th>
          <th scope="col">Prenom</th>
          <th scope="col">Nom</th>
          <th scope="col">Langue préférée</th>

          <th scope="col">Adresse</th>
          <th scope="col">Contact</th>
          <th scope="col">Status</th>
          <th scope="col">Description</th>

        </tr>
      </thead>
      <tbody id="tbody">
        <% for(proj of projects) { %>
          <tr>
            <td>
              <input type="checkbox">
            </td>
            <td>
              <%= proj.uidclient %>
            </td>
            <td>
              <%= proj.uidproject %>
            </td>
            <td>
              <a href="/editProject/<%= proj.uidproject %>">
                <span class="glyphicon glyphicon-pencil"></span>
              </a>|
              <a href="/vue_project/<%= proj.uidproject %>">
                <span class="glyphicon glyphicon-eye-open"></span>
              </a>
            </td>

            <td>
              <%= proj.firstname %>
            </td>
            <td>
              <%= proj.lastname %>
            </td>
            <td>
              <%= proj.lang %>
            </td>

            <td>
              <%= proj.street_no %>
                <%= proj.street%>
                  <%= proj.city %>
                    <%= proj.province %>
                      <%= proj.zip %>
            </td>
            <td>
              <%= proj.contact %>
            </td>
            <td>
              <%= proj.status %>
            </td>
            <td>
              <%= proj.description %>
            </td>

          </tr>
          <% } %>
      </tbody>
    </table>
  </div>
</body>
<script>
  $(document).ready(function () {

    $('#search').click(function (event) {
      event.preventDefault();
      var searchVal = $("#searchVal").val();

      console.log(searchVal)
      $.ajax("/searchproject/", {

        type: "GET",
        data: {
          searchVal: searchVal
        },

        success: function (data) {
          for (var i = 0; i < data.unikproject.length; i++) {
            console.log(data.unikproject[i].uidclient)
            $("#tbody").html("<tr><td><input type='checkbox'></td><td>" + data.unikproject[i].uidclient + "</td><td>" + data.unikproject[i].uidproject +
              "</td><td><a href='/edit_project/" + data.unikproject[i].uidproject + "'>|<span class='glyphicon glyphicon-pencil'></span></a><a href='/vue_project/" + data.unikproject[i].uidproject + "'>|<span class='glyphicon glyphicon-eye-open'></span>|</a></td><td>" + data.unikproject[i].firstname +
              "</td > <td>" + data.unikproject[i].lastname + "</td><td>" + data.unikproject[i].lang + "</td><td>" + data.unikproject[i].street_no + " " + data.unikproject[i].street + " " + data.unikproject[i].city + " " + data.unikproject[i].province + " " + data.unikproject[i].zip + "</td><td>" + data.unikproject[i].best_contact_way + "</td><td>" + data.unikproject[i].description + "</td><td>" + data.unikproject[i].status + "</td></tr>")
          }
        },
        error: function () {
          console.log('error!')
        }

      })
    })
    /*********************************************/
    $('#resetproj').click(function (event) {
      event.preventDefault();
      var searchVal = $("#searchVal").val();

      console.log(searchVal)
      $.ajax("/resetproj/", {

        type: "GET",
        data: {
          searchVal: searchVal
        },

        success: function (data) {
          console.log(data)
          for (var i = 0; i < data.projects.length; i++) {
            $("#searchVal").html = ''
            $("#tbody").append("<tr><td><input type='checkbox'></td><td>" + data.projects[i].uidclient + "</td><td>" + data.projects[i].uidproject +
              "</td><td><a href='#'>|<span class='glyphicon glyphicon-pencil'></span></a><a href='#'>|<span class='glyphicon glyphicon-eye-open'></span>|</a></td><td>" + data.projects[i].firstname +
              "</td > <td>" + data.projects[i].lastname + "</td><td>" + data.projects[i].lang + "</td><td>" + data.projects[i].street_no + " " + data.projects[i].street + " " + data.projects[i].city + " " + data.projects[i].province + " " + data.projects[i].zip + "</td><td>" + data.projects[i].contact + "</td><td>" + data.projects[i].status + "</td><td>" + data.projects[i].description + "</td></tr>")
          }
        },
        error: function () {
          console.log('error!')
        }

      })
    })
  })
</script>

</html>